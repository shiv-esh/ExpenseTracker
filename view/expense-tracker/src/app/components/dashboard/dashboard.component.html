<div class="dashboard-wrapper">
    <nav class="navbar">
        <div class="logo">Expense<span>Tracker</span></div>
        <div class="user-info">
            <span>Howdy, {{ user?.username }}</span>
            <button class="btn-logout" (click)="logout()">Logout</button>
        </div>
    </nav>

    <main class="content">
        <div class="dashboard-grid">
            <!-- Left Column: Summary + Add Expense -->
            <section class="add-expense-container">

                <!-- Daily Total Card -->
                <div class="glass-card total-summary">
                    <h4>Today's Total ({{ newExpense.date | date:'mediumDate' }})</h4>
                    <h2 class="total-amount">â‚¹{{ dailyTotal | number:'1.2-2' }}</h2>
                </div>

                <!-- Range Filter Card -->
                <div class="glass-card range-card">
                    <h3>Spending Summary</h3>
                    <div class="filter-tabs">
                        <button [class.active]="filterMode === 'weekly'" (click)="setFilter('weekly')">This
                            Week</button>
                        <button [class.active]="filterMode === 'monthly'" (click)="setFilter('monthly')">This
                            Month</button>
                        <button [class.active]="filterMode === 'custom'" (click)="setFilter('custom')">Custom</button>
                    </div>

                    <!-- Custom Date Range Inputs -->
                    <div class="custom-range" *ngIf="filterMode === 'custom'">
                        <div class="form-row">
                            <div class="form-group">
                                <label>From</label>
                                <input type="date" [(ngModel)]="customStartDate" name="customStart">
                            </div>
                            <div class="form-group">
                                <label>To</label>
                                <input type="date" [(ngModel)]="customEndDate" name="customEnd">
                            </div>
                        </div>
                        <button class="btn-apply" (click)="applyCustomRange()">Apply</button>
                    </div>

                    <div class="range-info">
                        <span class="range-label">{{ filterLabel }}</span>
                    </div>

                    <div class="range-total-display">
                        <span *ngIf="rangeLoading" class="loading-text">Calculating...</span>
                        <span *ngIf="!rangeLoading && rangeTotal !== null" class="range-amount">â‚¹{{ rangeTotal |
                            number:'1.2-2' }}</span>
                    </div>
                </div>

                <!-- Add Expense Form -->
                <section class="glass-card add-expense">
                    <h3>Add Daily Expense</h3>
                    <form (ngSubmit)="addExpense()" #expenseForm="ngForm">
                        <div class="form-row">
                            <div class="form-group">
                                <label>Amount (â‚¹)</label>
                                <input type="number" name="amount" [(ngModel)]="newExpense.amount" required
                                    placeholder="0.00">
                            </div>
                            <div class="form-group">
                                <label>Category</label>
                                <select name="category" [(ngModel)]="newExpense.category" required>
                                    <option [ngValue]="null" disabled>Select Category</option>
                                    <option *ngFor="let cat of categories" [ngValue]="cat">{{ cat.name }}</option>
                                </select>
                            </div>
                        </div>

                        <div class="form-group">
                            <label>Description (Optional)</label>
                            <textarea name="description" [(ngModel)]="newExpense.description"
                                placeholder="What was this for?"></textarea>
                        </div>

                        <div class="form-group">
                            <label>Date</label>
                            <input type="date" name="date" [(ngModel)]="newExpense.date" (change)="onDateChange()"
                                required>
                        </div>

                        <button type="submit" class="btn-primary" [disabled]="!expenseForm.form.valid">Add
                            Expense</button>
                    </form>
                </section>
            </section>

            <!-- Expense List -->
            <section class="glass-card expense-list">
                <h3>Your Expenses</h3>
                <div class="scroll-area">
                    <div class="empty-state" *ngIf="expenses.length === 0">
                        <p>No expenses found. Start adding some!</p>
                    </div>
                    <table *ngIf="expenses.length > 0">
                        <thead>
                            <tr>
                                <th>Date</th>
                                <th>Category</th>
                                <th>Description</th>
                                <th>Amount</th>
                                <th></th>
                            </tr>
                        </thead>
                        <tbody>
                            <tr *ngFor="let exp of expenses">
                                <td>{{ exp.date }}</td>
                                <td><span class="badge">{{ exp.category?.name }}</span></td>
                                <td>{{ exp.description || '-' }}</td>
                                <td class="amount">â‚¹{{ exp.amount | number:'1.2-2' }}</td>
                                <td><button class="btn-delete" (click)="deleteExpense(exp.id)"
                                        title="Delete">ðŸ—‘</button></td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </main>
</div>